#!/usr/bin/gosh

(use gauche.process)
(use file.util)
(use srfi-13)

(define *home* (home-directory))
(define *es* "/.es")
(define *file* "/.complitions")

(define *dict* (string-append *home* *es* *file*))


(define (make-dict)
  (with-output-to-file *dict*
    (lambda ()
      (for-each
       (lambda (w) (print w))
       (directory-list (string-append *home* *es*)))))
  )

(define (add-word w)
  (with-output-to-file *dict*
    (lambda () (print w))    
    :if-exists :append))

(define (esi)
  (make-dict)
  (let loop ((word (read-line)))
    (when (string=? word "q") (exit))
    (run-process `(es ,(string-trim-both word)) :wait #t)
    (add-word word)
    (loop (read-line))))

(define (main args)
  (esi))
