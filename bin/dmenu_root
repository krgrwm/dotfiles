prompt=$(basename ${1})
source "$1/color"

if [[ $1 ]]; then
    hist=`cat "$1/history"`
    cmd_dmenu="dmenu2 -w 600 -nb $nb -nf $nf -sb $sb -p $prompt -hist $hist -i -l 20"
    echo $cmd_dmenu
    res1=$($1/source)

    if [[ ! -e $hist ]] ; then
        touch $hist
    fi

    echo $cmd_dmenu
    result=$(echo "$res1" | $cmd_dmenu | $SHELL "$1/post")

    if [[ $result ]] ; then
        echo $result
        $SHELL "$1/run" "$result"
    fi
fi
